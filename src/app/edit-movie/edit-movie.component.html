<div class="container-fluid py-4">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Chỉnh sửa phim</h5>
      <button class="btn btn-outline-secondary" (click)="goBack()">
        <i class="mdi mdi-arrow-left"></i> Quay lại
      </button>
    </div>
    <div class="card-body">
      <form [formGroup]="movieForm" (ngSubmit)="onSubmit()" class="row g-3">
        <div class="col-md-6">
          <div class="form-group">
            <label for="movieName" class="form-label">Tên phim <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="movieName" formControlName="movieName"
              [class.is-invalid]="movieForm.get('movieName')?.invalid && movieForm.get('movieName')?.touched">
            <div class="invalid-feedback"
              *ngIf="movieForm.get('movieName')?.invalid && movieForm.get('movieName')?.touched">
              Vui lòng nhập tên phim
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="duration" class="form-label">Thời lượng (phút) <span class="text-danger">*</span></label>
            <input type="number" class="form-control" id="duration" formControlName="duration"
              [class.is-invalid]="movieForm.get('duration')?.invalid && movieForm.get('duration')?.touched">
            <div class="invalid-feedback"
              *ngIf="movieForm.get('duration')?.invalid && movieForm.get('duration')?.touched">
              Thời lượng phải lớn hơn 0
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="releaseDate" class="form-label">Ngày phát hành <span class="text-danger">*</span></label>
            <input type="date" class="form-control" id="releaseDate" formControlName="releaseDate"
              [class.is-invalid]="movieForm.get('releaseDate')?.invalid && movieForm.get('releaseDate')?.touched">
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="status" class="form-label">Trạng thái</label>
            <select class="form-select" id="status" formControlName="status">
              <option [value]="1">Hoạt động</option>
              <option [value]="0">Không hoạt động</option>
            </select>
          </div>
        </div>

        <div class="col-12">
          <div class="form-group">
            <label for="description" class="form-label">Mô tả <span class="text-danger">*</span></label>
            <textarea class="form-control" id="description" formControlName="description" rows="3"
              [class.is-invalid]="movieForm.get('description')?.invalid && movieForm.get('description')?.touched"></textarea>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="thumbnail" class="form-label">Ảnh thumbnail</label>
            <input type="file" class="form-control" id="thumbnail" (change)="onFileSelect($event, 'thumbnail')"
              accept="image/*">
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="trailer" class="form-label">Trailer</label>
            <input type="file" class="form-control" id="trailer" (change)="onFileSelect($event, 'trailer')"
              accept="video/*">
          </div>
        </div>

        <!-- Phần diễn viên trong form -->
        <div class="mb-3 col-12">
          <label class="form-label">Diễn viên</label>
          <div class="selected-actors mb-2">
            <span *ngFor="let actor of selectedActors" class="badge bg-primary me-2 mb-2">
              {{actor.name}}
              <button type="button" class="btn-close btn-close-white ms-2" (click)="removeActor(actor)"
                style="font-size: 0.5rem;">
              </button>
            </span>
          </div>
          <div class="actor-search-container position-relative">
            <input type="text" class="form-control" [(ngModel)]="searchTerm" [ngModelOptions]="{standalone: true}"
              (input)="filterActors()" (focus)="showDropdown = true" placeholder="Tìm kiếm diễn viên...">

            <!-- Dropdown list -->
            <div class="actor-dropdown shadow" *ngIf="showDropdown && filteredActors.length > 0">
              <div class="list-group">
                <button type="button" *ngFor="let actor of filteredActors"
                  class="list-group-item list-group-item-action" (click)="selectActor(actor)">
                  {{actor.name}}
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Phần thể loại -->
        <div class="mb-3 col-12">
          <label class="form-label">Thể loại</label>
          <div class="selected-genres mb-2">
            <span *ngFor="let genre of selectedGenres" class="badge bg-info me-2 mb-2">
              {{genre.genreName}}
              <button type="button" class="btn-close btn-close-white ms-2" (click)="removeGenre(genre)"
                style="font-size: 0.5rem;">
              </button>
            </span>
          </div>
          <div class="genre-search-container position-relative">
            <input type="text" class="form-control" [(ngModel)]="genreSearchTerm" [ngModelOptions]="{standalone: true}"
              (input)="filterGenres()" (focus)="showGenreDropdown = true" placeholder="Tìm kiếm thể loại...">

            <!-- Dropdown list -->
            <div class="genre-dropdown shadow" *ngIf="showGenreDropdown && filteredGenres.length > 0">
              <div class="list-group">
                <button type="button" *ngFor="let genre of filteredGenres"
                  class="list-group-item list-group-item-action" (click)="selectGenre(genre)">
                  {{genre.genreName}}
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary me-3" [disabled]="!movieForm.valid || isLoading">
              <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
              {{isLoading ? 'Đang cập nhật...' : 'Cập nhật'}}
            </button>
            <button type="button" class="btn btn-outline-danger" (click)="goBack()">Hủy</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>