<div class="container-fluid">
    <!-- Header và bộ lọc -->
    <div class="row mb-4">
        <div class="col-md-4">
            <h2 class="page-title">Quản lý phòng chiếu</h2>
        </div>
        <div class="col-md-4">
            <div class="input-group header-search">
                <input 
                    type="text" 
                    class="form-control" 
                    placeholder="Tìm kiếm theo tên phòng..." 
                    [(ngModel)]="searchTerm" 
                    (keyup.enter)="onSearch()"
                >
                <button 
                    class="btn btn-primary" 
                    type="button"
                    (click)="onSearch()"
                >
                    <i class="fas fa-search"></i> Tìm kiếm
                </button>
            </div>
        </div>
        <div class="col-md-4 d-flex justify-content-end">
            <button class="btn-lg btn-primary header-button" data-bs-toggle="modal" data-bs-target="#addRoom">
                <i class="fas fa-plus me-2"></i> Thêm phòng mới
            </button>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3">
            <select class="form-select header-select" [(ngModel)]="statusFilter" (change)="applyFilters()">
                <option value="-1">Tất cả trạng thái</option>
                <option value="1">Có sẵn</option>
                <option value="2">Đang bảo trì</option>
                <option value="3">Đang dọn dẹp</option>
                <option value="4">Đang sử dụng</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select header-select" [(ngModel)]="cinemaFilter" (change)="applyFilters()">
                <option value="-1">Tất cả rạp phim</option>
                <option *ngFor="let cinema of cinemas" [value]="cinema.cinemasId">{{ cinema.name }}</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select header-select" [(ngModel)]="roomTypeFilter" (change)="applyFilters()">
                <option value="-1">Tất cả loại phòng</option>
                <option *ngFor="let type of roomTypes" [value]="type.roomTypeId">{{ type.name }}</option>
            </select>
        </div>
        <div class="col-md-3">
            <div class="d-flex justify-content-between">
                <button class="btn btn-outline-secondary clear-filter-btn" (click)="clearFilters()">
                    <i class="fas fa-times me-1"></i> Xóa bộ lọc
                </button>
                <span class="records-info">Hiển thị {{rooms.length}} / {{totalRecords}} phòng</span>
            </div>
        </div>
    </div>

    <!-- Bảng danh sách phòng -->
    <div class="card shadow-sm">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th class="text-center" style="width: 50px">#</th>
                            <th>Tên phòng</th>
                            <th>Rạp phim</th>
                            <th>Loại phòng</th>
                            <th class="text-center">Tổng số ghế</th>
                            <th class="text-center">Giá ghế</th>
                            <th class="text-center">Trạng thái</th>
                            <th class="text-center" style="width: 150px">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let room of rooms; let i = index">
                            <td class="text-center">{{ (currentPage - 1) * recordPerPage + i + 1 }}</td>
                            <td>{{ room.name }}</td>
                            <td>{{ getCinemaName(room.cinemaId) }}</td>
                            <td>{{ getRoomTypeName(room.roomTypeId) }}</td>
                            <td class="text-center">{{ room.totalSeats }}</td>
                            <td class="text-center">{{ room.seatPrice.toString() }} VNĐ</td>
                            <td class="text-center">
                                <span [class]="getStatusBadgeClass(room.status)">
                                    {{ getStatusText(room.status) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <button class="btn btn-outline-warning btn-sm btn-rounded" 
                                        (click)="editRoomv2(room.id)" 
                                        title="Sửa phòng"
                                        [disabled]="!canUpdateStatus(room)">
                                    <i class="fas fa-edit me-1"></i> Sửa phòng
                                </button>
                                <button class="btn btn-outline-primary btn-rounded" 
                                        (click)="onEditRoom(room.id, room.totalSeats)">
                                    <i class="fas fa-edit me-1"></i>Sửa sơ đồ ghế 
                                </button>
                                <button class="btn btn-outline-danger btn-sm btn-rounded" 
                                        (click)="deleteRoom(room.id)" 
                                        title="Xóa phòng"
                                        [disabled]="!canUpdateStatus(room)">
                                    <i class="fas fa-trash"></i> Xoá
                                </button>
                            </td>
                        </tr>
                        <tr *ngIf="rooms.length === 0">
                            <td colspan="8" class="text-center py-4">
                                <i class="fas fa-search fa-2x mb-2 text-muted"></i>
                                <p class="text-muted">Không tìm thấy phòng nào phù hợp với tiêu chí tìm kiếm.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Phân trang -->
            <nav *ngIf="totalPages > 0" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                        <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage - 1)">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    <li class="page-item" *ngFor="let page of pages" [class.active]="page === currentPage">
                        <a class="page-link" href="javascript:void(0)" (click)="onPageChange(page)">{{ page }}</a>
                    </li>
                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                        <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage + 1)">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Nhúng component sửa phòng (modal) -->
    <app-edit-room></app-edit-room>

    <!-- Nhúng component sửa thông tin phòng -->
    <app-edit-room-info #editRoomInfoComponent (roomUpdated)="loadRooms()"></app-edit-room-info>

    <!-- Nhúng component thêm phòng -->
    <app-add-room (roomAdded)="onRoomAdded()"></app-add-room>
</div>